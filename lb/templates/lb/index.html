<html>
	<head>
		<title>Load Balancer APP!</title>
		<meta http-equiv=Content-Type content="text/html;charset=utf-8">
        <style type="text/css">
            .host_list, .pool_list, .member_list{margin-left: 20px; margin-top:10px;}
            .host, .member{margin-bottom: 10px;}
            .vip span{color: red;}
            .pool span{color: blue;}
            .member span{color: black;}
        </style>
        <script type="text/javascript" src="http://code.jquery.com/jquery-1.11.2.min.js"></script>
        <script type="text/javascript">
          $(document).ready(function(){
              // modify vip
              $('.vip_modifition_button').click(function(){
                  var vid = $(this).parents('.vip').attr('vid');
                  console.log('modify vip ' + vid);
              });
              // delete member
              $('.member_deletion_button').click(function(){
                  var mid = $(this).parents('.member').attr('mid');
                  $.ajax({
                      type: 'POST',
                      url: 'ajax_del_member',
                      data:'mid='+mid ,
                      success:function(data) {
                            alter('delete member success');
                      },
                      error:function() {},
                  });
                  console.log('delete member ' + mid);
              });
              // modify member
              $('.member_modifition_button').click(function(){
                  var mid = $(this).parents('.member').attr('mid');
                  console.log('modify member ' + mid);
              });
              // add member
              $('.member_addition_button').click(function(){
                  var ipv4 = $(this).parents('.host').attr('ipv4');
                  var port = $(this).parents('.host').attr('port');
                  var mid = ipv4;
                  var pid = $('.pool').attr('pid');
                  var member_list = $('.member');
                  //console.log('length: ' + member_list.size())
                  for (var i=0; i<member_list.size(); i++){
                      member = member_list[i]
                      //console.log('member.id: ' + $(member).attr('mid'));
                      if (mid == $(member).attr('mid')){
                            alert('member alreadly exist!!');
                            return;
                      } 
                  }
                  //member = '{"id":"1", "pool_id":"1", "address":"10.0.0.1", "port":"80"}'
                  var member = '{"id":"'+mid+'", "pool_id":"'+pid+'", "address":"'+ipv4+'", "port":"'+port+'"}'
                  console.log('add member ' + member);
              });
          });
        </script>
	</head>
	<body>
		<h1>Hello, This is Load Balancer APP!</h1>
        <hr/>
        <h2>Host list</h2>
        <div class="host_list">
        {% for h in host_list %}
        <div class="host" ipv4="{{h.ipv4}}" port="80">
                <span>{{h}}
                    &nbsp;&nbsp;<input type="button" value="添加" class="member_addition_button"/>
                </span>
            </div>
        {% endfor %}
        </div>
        <hr/>
        <div class="vip_list">
        <h2>VIP list</h2>
        {% for vip in vip_list %}
        <div class="vip" vid="{{vip.vid}}">
                <span>{{vip}}
                    &nbsp;&nbsp;<input type="button" value="修改" class="vip_modifition_button"/>
                <div class="pool_list">
                {% for pool in vip.lbpool_set.all %}
                <div class="pool" pid="{{pool.pid}}">
                        <span>{{pool}}</span>
                        <div class="member_list">
                        {% for member in pool.lbmember_set.all %}
                        <div class="member" mid="{{member.mid}}">
                          <span>{{member}} 
                            &nbsp;&nbsp;<input type="button" value="修改" class="member_modifition_button"/>
                            &nbsp;&nbsp;<input type="button" value="删除" class="member_deletion_button"/>
                          </span>
                            </div>
                        {% endfor %}
                        </div>
                    </div>
                {% endfor %}
                </div>
            </div>
        {% endfor %}
        </div>
	</body>
</html>
